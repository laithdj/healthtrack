<div class="container-fluid">
  <div class="row ">
    <div class="col patient-panel side-padding">
      <app-patient-summary [patient]="patient$ | async"></app-patient-summary>      
    </div>
  </div>
  <div class="row" style="padding-top: 10px;"
    [ngClass]="(showReportBeside$ | async) ? 'row-custom' : ''">
    <div class="col">
      <div>
        <dx-tabs #selectTab
          [dataSource]="tabs"
          [selectedIndex]="0"
          [ngClass]="(showReportBeside$ | async) ? 'fixed-form' : 'w-100'" >
        </dx-tabs>
        <div *ngIf="selectTab.selectedIndex === 0"
          [ngClass]="(showReportBeside$ | async) ? 'fixed-form hms-tab-content' : 'hms-tab-content'">
          <dx-form [width]="'100%'" [colCount]="2"
            [ngClass]="(showReportBeside$ | async) ? '' : 'side-padding'">
            <dxi-item itemType="group" [colSpan]="2" [colCount]="10" cssClass="mt-3">
              <dxi-item itemType="group" [colSpan]="(showReportBeside$ | async) ? 6 : 4">
                <dxi-item itemType="group" [cssClass]="(showReportBeside$ | async) ? 'align-fields' : ''" [colCount]="15">
                  <dxi-item [label]="{ text: 'Procedure/Test Date' }" [colSpan]="10">
                    <dx-date-box [useMaskBehavior]="true"
                      type="datetime"
                      [class]="(showReportBeside$ | async) ? 'date-report' :'date-width'">
                    </dx-date-box>
                  </dxi-item>
                  <dxi-item [label]="{ text: 'Duration' }" [colSpan]="5"
                    [cssClass]="(showReportBeside$ | async) ? 'duration-align' : ''">
                    <dx-number-box [showSpinButtons]="true" format="# mins"
                      [value]="duration" [min]="0"
                      [class]="(showReportBeside$ | async) ? 'duration-report' :'duration-width'">
                    </dx-number-box>
                  </dxi-item>
                </dxi-item>
                <dxi-item [label]="{ text: 'Procedure' }">
                  <dx-select-box [class]="(showReportBeside$ | async) ? 'procedure-report' :'procedure-width'"
                    [readOnly]="true" [value]="'Echocardiogram'">
                  </dx-select-box>
                </dxi-item>
              </dxi-item>
              <dxi-item itemType="group" [colSpan]="4" >
                <dxi-item [label]="{ text: 'Hospital Site' }"  [cssClass]="(showReportBeside$ | async) ? '' :'ml-15'">
                  <dx-select-box [displayExpr]="'name'"
                    [valueExpr]="'locationId'" [width]="(showReportBeside$ | async) ? '' : 300">
                  </dx-select-box>
                </dxi-item>
              </dxi-item>    
            </dxi-item>
            <dxi-item itemType="group" [colSpan]="2" caption="Patient Baseline" cssClass="mt-3">
              <dxi-item itemType="group" [colSpan]="2" [colCount]="(showReportBeside$ | async) ? 2 : 4">
                <dxi-item [label]="{ text: 'Heart Rate' }"  [colSpan]="1">
                  <div *dxTemplate>
                    <div class="d-flex flex-row">
                      <dx-number-box [width]="80"></dx-number-box>
                      <span class="m-1">bpm</span>
                    </div>
                  </div>
                </dxi-item>
                <dxi-item  [label]="{ text: 'Blood Pressure' }" [colSpan]="1" cssClass="ml-3">
                  <div *dxTemplate class="d-flex flex-row">
                    <dx-number-box [width]="40"></dx-number-box>
                    <span class="dash-style">/</span>
                    <dx-number-box [width]="40"></dx-number-box>
                  </div>
                </dxi-item> 
                  <dxi-item itemType="group" [colSpan]="2">
                  </dxi-item>
              </dxi-item>
                <dxi-item itemType="group" [colSpan]="2" [colCount]="(showReportBeside$ | async) ? 2 : 4" cssClass="expand-span">
                    <dxi-item [label]="{ text: 'Height' }"  [colSpan]="1">
                      <div *dxTemplate class="d-flex flex-row">
                        <dx-number-box [width]="80" format="0#.0" [min]="0">
                        </dx-number-box>
                        <span class="m-1" style="margin-right:14px!important;width:16px;">
                          {{heightUnit}}
                        </span>
                      </div>
                    </dxi-item>
                    <dxi-item itemType="group" [colSpan]="1">
                    </dxi-item>
                </dxi-item>
                <dxi-item itemType="group" [colSpan]="2" [colCount]="(showReportBeside$ | async) ? 2 : 4" cssClass="expand-span">
                    <dxi-item [label]="{ text: 'Weight' }" [colSpan]="1">
                        <div *dxTemplate class="d-flex flex-row">
                        </div>
                    </dxi-item>
                    <dxi-item  [colSpan]="1" cssClass="ml-3">
                        <div *dxTemplate class="d-flex flex-row">
                            <div style="width:91px"></div>
                        </div>
                    </dxi-item>
                    <dxi-item itemType="group" [colSpan]="1">
                    </dxi-item>
                </dxi-item>
                <dxi-item itemType="group" [colSpan]="2" [colCount]="(showReportBeside$ | async) ? 2 : 4" cssClass="expand-span">
                    <dxi-item  [label]="{ text: 'BMI' }" [colSpan]="1">
                        <div *dxTemplate class="d-flex flex-row">
                            <dx-number-box  [width]="80" style="margin-right:33px;" [readOnly]="true" format="0#.0">
                            </dx-number-box>
                            <dx-text-box [width]="100" [readOnly]="true">
                            </dx-text-box>
                        </div>
                    </dxi-item>
                    <dxi-item [label]="{ text: 'BSA' }" [colSpan]="1" cssClass="ml-3">
                        <div *dxTemplate class="d-flex flex-row">
                            <dx-number-box [width]="92" style="margin-right:33px;" [readOnly]="true" format="0#.00">
                            </dx-number-box>
                            <dx-select-box [width]="100"  [readOnly]="true">
                            </dx-select-box>
                        </div>
                    </dxi-item>
                    <dxi-item itemType="group" [colSpan]="1">
                    </dxi-item>
                </dxi-item>
            </dxi-item>
    <!-- <dxi-item itemType="group" [colSpan]="2" [colCount]="(showReportBeside$ | async) ? 2 : 10" caption="Staff" cssClass=" mt-3">
        <dxi-item itemType="group" [colSpan]="4" cssClass="expand-span">
            <dxi-item [label]="{ text: 'Cardiologist' }" [editorType]="'dxSelectBox'">
                <dx-select-box [displayExpr]="'staffName'" [valueExpr]="'staffId'"
                   [width]="212">
                </dx-select-box>
            </dxi-item>
            <dxi-item [label]="{ text: 'Radiologist' }" [editorType]="'dxSelectBox'">
                <dx-select-box [displayExpr]="'staffName'" [valueExpr]="'staffId'" [width]="212"
                    >
                </dx-select-box>
            </dxi-item>
            <dxi-item [label]="{ text: 'Fellow' }" [editorType]="'dxSelectBox'">
                <dx-select-box [displayExpr]="'staffName'" [valueExpr]="'staffId'"  [width]="212"
                    [>
                </dx-select-box>
            </dxi-item>
            </dxi-item>
        </dxi-item> -->
    <!-- <dxi-item itemType="group" [colSpan]="2" [colCount]="10" caption="Indications" cssClass=" mt-3">
        <dxi-item  [colSpan]="(showReportBeside$ | async) ? 6 : 5">
            <dx-button [text]="'Edit'" [ngClass]="(showReportBeside$ | async) ? 'float-custom-side' : 'float-custom'" [type]="'default'">
            </dx-button>
            <div class="list-container mr-3">
                <dx-list [height]="100" [width]="'90%'"  [displayExpr]="'itemValue'" [noDataText]="'Not Specified'"
                    [grouped]="false" [collapsibleGroups]="false">
                </dx-list>
            </div>
        </dxi-item>
        <dxi-item [colSpan]="4" [label]="{ text: 'Details' }" [editorType]="'dxTextArea'">
            <dx-text-area [height]="100">
            </dx-text-area>
        </dxi-item>
    </dxi-item>
    <dxi-item itemType="group" [colSpan]="2" [colCount]="10" caption="Risk Factors" cssClass=" mt-3">
        <dxi-item [colSpan]="(showReportBeside$ | async) ? 6 : 5">
            <dx-button [text]="'Edit'" [ngClass]="(showReportBeside$ | async) ? 'float-custom-side' : 'float-custom'" [type]="'default'" >
            </dx-button>
            <div class="list-container mr-3">
                <dx-list [height]="100" [width]="'90%'" [displayExpr]="'itemValue'" [noDataText]="'Not Specified'">
                </dx-list>
            </div>
        </dxi-item>
        <dxi-item [colSpan]="4" [label]="{ text: 'Details' }" [editorType]="'dxTextArea'">
            <dx-text-area [height]="100">
            </dx-text-area>
        </dxi-item>
    </dxi-item> -->
</dx-form>
<!-- <dx-popup class="popup" [height]="390" [width]="300" title="Indications" [showTitle]="true" [showCloseButton]="false"
    [visible]="indicationsList">
    <div class="list widget-container">
        <dx-list [items]="indicationsList$  | async" [displayExpr]="'itemValue'" [height]="300"  [width]="'100%'"
        (onSelectionChanged)="selectionChanged($event,selectedItems,'indications')"
            [showSelectionControls]="true" selectionMode="multiple" [(selectedItems)]="selectedItems">
        </dx-list>
    </div>
    <div class="mt-2">
        <div style="width: 100%">
            <dx-button [width]="90" text="Done" type="success" class="float-right" (onClick)="closeIndication()"
                style="margin-right: 0px">
            </dx-button>
        </div>
    </div>
</dx-popup> -->
<!-- <dx-popup class="popup" [height]="390" [width]="300" title="Risk Factors" [showTitle]="true" [showCloseButton]="false"
    [visible]="riskFactorsList">
    <div class="list widget-container">
        <dx-list [items]="riskFactorsList$ | async" [displayExpr]="'itemValue'" [height]="300"  [width]="'100%'"
         (onSelectionChanged)="selectionChanged($event,selectedRiskItems,'riskFactors')"
            [showSelectionControls]="true" selectionMode="multiple" [(selectedItems)]="selectedRiskItems">
        </dx-list>
    </div>
    <div class="mt-2">
        <div style="width: 100%">
            <dx-button [width]="90" text="Done" type="success" class="float-right" (onClick)="closeRiskFactors()"
                style="margin-right: 0px">
            </dx-button>
        </div>
    </div>
</dx-popup> -->

        </div>
        <div *ngIf="(selectTab.selectedIndex === 1)" [ngClass]="(showReportBeside$ | async) ? 'fixed-form hms-tab-content' : 'hms-tab-content'">
          <input type="file" class="file-upload" (change)="onUploadFile($event)">
          <igx-spreadsheet #spreadsheet height="500px" width="100%" style="background-color: white; margin-top: 10px">
          </igx-spreadsheet>
        </div>
        <div *ngIf="((reportRender) || (selectTab.selectedIndex === 2 && (showReportBeside$ | async) === false))"
          [ngClass]="(selectTab.selectedIndex === 2 && (showReportBeside$ | async) === false) ? 'hms-tab-content' : 'hide hms-tab-content'">
          <!--          
          (openConfigScreen)="openSmartTextEditor()"          
          > -->
          <lib-smart-text-report #reportInTab id="reportInTab"
            [richEditorSize]="{ height: 'calc(100vh - 250px)', width: '815px' }"
            [drawerHeight]="'calc(100vh - 275px)'"
            [lowerListHeight]="'calc(75vh - 285px)'"
            [showReportBeside]="showReportBeside$ | async"
            [reportContent]="(report$ | async)?.fullStructuredReport"
            [userName]="userName$ | async"
            (refreshSmartText)="refreshSmartText()"
            [hmsLetterTemplateTagValues]="letterTemplateTagValues"
            (fetchHMSLetterTagValues)="fetchLetterTagValues($event)"
            (showReportBesideToggled)="toggleShowReportBeside($event)"
            [smartTextBundle]="smartTextBundle$ | async"
            [measurements]="measurements"
            [showSmartText]="true"> 
          </lib-smart-text-report>
        </div>
      </div>
    </div>
    <div *ngIf="showReportBeside$ | async" class="report" style="padding-left: 0px;">
      <div>
        <!-- 
        [hmsLetterTemplateTagValues]="letterTemplateTagValues"
        (openConfigScreen)="openSmartTextEditor()"
        (fetchHMSLetterTagValues)="fetchLetterTagValues($event)"
        (refreshSmartText)="refreshSmartText()" -->
        <lib-smart-text-report #reportBeside id="reportBeside"
          [richEditorSize]="{ height: 'calc(100vh - 195px)', width: '100%' }"
          [drawerHeight]="'calc(100vh - 210px)'"
          [lowerListHeight]="'calc(75vh - 230px)'"
          [reportContent]="(report$ | async)?.fullStructuredReport"
          [userName]="userName$ | async"
          [showSmartText]="false"
          (refreshSmartText)="refreshSmartText()"
          [hmsLetterTemplateTagValues]="letterTemplateTagValues"
          (fetchHMSLetterTagValues)="fetchLetterTagValues($event)"
          (showReportBesideToggled)="toggleShowReportBeside($event)"
          [smartTextBundle]="smartTextBundle$ | async"
          [measurements]="measurements"
          [showReportBeside]="showReportBeside$ | async">
        </lib-smart-text-report>
      </div>      
    </div>
  </div>
  <div class="hms-buttons-footer d-flex-unset">
    <hms-button-set-save
      [includeDeleteButton]="false">
    </hms-button-set-save>
  </div>
</div>
<!-- [(visible)]="loadingVisible"
[message]='loadMessage' -->
<dx-load-panel
  #loadPanel
  shadingColor="rgba(0,0,0,0.4)"
  [showIndicator]="true"
  [showPane]="true"
  [shading]="true"
  [closeOnOutsideClick]="false">
</dx-load-panel>
<!-- [(visible)]="loading" -->
<dx-load-panel
  #OnInItLoad
  shadingColor="rgba(0,0,0,0.4)" 
  [message]='"Loading Record"'
  [showIndicator]="true"
  [showPane]="true"
  [shading]="true"
  [closeOnOutsideClick]="false">
</dx-load-panel>